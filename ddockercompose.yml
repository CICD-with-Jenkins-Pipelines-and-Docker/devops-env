version: '3.1'
services:
          jenkins:
                      image: 256cb12e72d6
                          container_name: jenkins
                              user: jenkins
                                  environment:
                                                JENKINS_HOST_HOME: "/opt/jenkins/data/jenkins"
                                                    ports:
                                                                  - "9080:8080"
                                                                          - "5005:5000"
                                                                                  - "50005:50000"

                                                                                      nexus:
                                                                                                  image: sonatype/nexus3:3.16.2
                                                                                                      ports:
                                                                                                                    - "9081:8081"
                                                                                                                         
                                                                                                                        jira:
                                                                                                                                    image: cptactionhank/atlassian-jira-software
                                                                                                                                        environment:
                                                                                                                                                      X_PROXY_NAME: jira.${REVERSE_PROXY_DOMAIN_NAME}
                                                                                                                                                            X_PROXY_PORT: 443
                                                                                                                                                                  X_PROXY_SCHEME: https
                                                                                                                                                                      
                                                                                                                                                                    sonarqube:
                                                                                                                                                                                image: sonarqube
                                                                                                                                                                                    ports:
                                                                                                                                                                                                  - "9082:9000"
                                                                                                                                                                                                        networks:
                                                                                                                                                                                                                      - sonarnet
                                                                                                                                                                                                                            environment:
                                                                                                                                                                                                                                          - sonar.jdbc.url=jdbc:postgresql://db:5432/sonar
                                                                                                                                                                                                                                                volumes:
                                                                                                                                                                                                                                                              - sonarqube_conf:/opt/sonarqube/conf
                                                                                                                                                                                                                                                                      - sonarqube_data:/opt/sonarqube/data
                                                                                                                                                                                                                                                                              - sonarqube_extensions:/opt/sonarqube/extensions

                                                                                                                                                                                                                                                                                  db:
                                                                                                                                                                                                                                                                                              image: postgres
                                                                                                                                                                                                                                                                                                  networks:
                                                                                                                                                                                                                                                                                                                - sonarnet
                                                                                                                                                                                                                                                                                                                      environment:
                                                                                                                                                                                                                                                                                                                                    - POSTGRES_USER=sonar
                                                                                                                                                                                                                                                                                                                                            - POSTGRES_PASSWORD=sonar
                                                                                                                                                                                                                                                                                                                                                  volumes:
                                                                                                                                                                                                                                                                                                                                                                - postgresql:/var/lib/postgresql
                                                                                                                                                                                                                                                                                                                                                                        # This needs explicit mapping due to https://github.com/docker-library/postgres/blob/4e48e3228a30763913ece952c611e5e9b95c8759/Dockerfile.template#L52
                                                                                                                                                                                                                                                                                                                                                                        #       - postgresql_data:/var/lib/postgresql/data
                                                                                                                                                                                                                                                                                                                                                                        #
                                                                                                                                                                                                                                                                                                                                                                        #       networks:
                                                                                                                                                                                                                                                                                                                                                                        #         sonarnet:
                                                                                                                                                                                                                                                                                                                                                                        #             driver: bridge
                                                                                                                                                                                                                                                                                                                                                                        #
                                                                                                                                                                                                                                                                                                                                                                        #             volumes:
                                                                                                                                                                                                                                                                                                                                                                        #               sonarqube_conf:
                                                                                                                                                                                                                                                                                                                                                                        #                 sonarqube_data:
                                                                                                                                                                                                                                                                                                                                                                        #                   sonarqube_extensions:
                                                                                                                                                                                                                                                                                                                                                                        #                     postgresql:
                                                                                                                                                                                                                                                                                                                                                                        #                       postgresql_data:
